/*
 RequireJS 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

//
//  ____  _                           _
// / ___|| |_ __ _ _ __   ___  ___   (_)___  (*)
// \___ \| __/ _` | '_ \ / _ \/ __|  | / __|
//  ___) | || (_| | |_) |  __/\__ \_ | \__ \
// |____/ \__\__,_| .__/ \___||___(_)/ |___/
//              |_|              |__/
//
// (*) a (really) tiny Javascript MVC microframework
//
// (c) Hay Kranen < hay@bykr.org >
// Released under the terms of the MIT license
// < http://en.wikipedia.org/wiki/MIT_License >
//
// Stapes.js : http://hay.github.com/stapes

/** @license
 * RequireJS plugin for async dependency load like JSONP and Google Maps
 * Author: Miller Medeiros
 * Version: 0.1.1 (2011/11/17)
 * Released under the MIT license
 */

/**
		 * @name MarkerWithLabel for V3
		 * @version 1.1.5 [July 11, 2011]
		 * @author Gary Little (inspired by code from Marc Ridey of Google).
		 * @copyright Copyright 2010 Gary Little [gary at luxcentral.com]
		 * @fileoverview MarkerWithLabel extends the Google Maps JavaScript API V3
		 *  <code>google.maps.Marker</code> class.
		 *  <p>
		 *  MarkerWithLabel allows you to define markers with associated labels. As you would expect,
		 *  if the marker is draggable, so too will be the label. In addition, a marker with a label
		 *  responds to all mouse events in the same manner as a regular marker. It also fires mouse
		 *  events and "property changed" events just as a regular marker would. Version 1.1 adds
		 *  support for the raiseOnDrag feature introduced in API V3.3.
		 *  <p>
		 *  If you drag a marker by its label, you can cancel the drag and return the marker to its
		 *  original position by pressing the <code>Esc</code> key. This doesn't work if you drag the marker
		 *  itself because this feature is not (yet) supported in the <code>google.maps.Marker</code> class.
		 */

/*!
		 *
		 * Licensed under the Apache License, Version 2.0 (the "License");
		 * you may not use this file except in compliance with the License.
		 * You may obtain a copy of the License at
		 *
		 *       http://www.apache.org/licenses/LICENSE-2.0
		 *
		 * Unless required by applicable law or agreed to in writing, software
		 * distributed under the License is distributed on an "AS IS" BASIS,
		 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
		 * See the License for the specific language governing permissions and
		 * limitations under the License.
		 */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

var requirejs,require,define;(function(Y){function w(b){return I.call(b)==="[object Function]"}function D(b){return I.call(b)==="[object Array]"}function o(b,c){if(b){var d;for(d=0;d<b.length;d+=1)if(b[d]&&c(b[d],d,b))break}}function M(b,c){if(b){var d;for(d=b.length-1;d>-1;d-=1)if(b[d]&&c(b[d],d,b))break}}function x(b,c){for(var d in b)if(b.hasOwnProperty(d)&&c(b[d],d))break}function J(b,c,d,g){return c&&x(c,function(c,j){if(d||!E.call(b,j))g&&typeof c!="string"?(b[j]||(b[j]={}),J(b[j],c,d,g)):b[j]=c}),b}function t(b,c){return function(){return c.apply(b,arguments)}}function Z(b){if(!b)return b;var c=Y;return o(b.split("."),function(b){c=c[b]}),c}function $(b,c,d){return function(){var g=ga.call(arguments,0),f;return d&&w(f=g[g.length-1])&&(f.__requireJsBuild=!0),g.push(c),b.apply(null,g)}}function aa(b,c,d){o([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(g){var f=g[1]||g[0];b[g[0]]=c?$(c[f],d):function(){var b=y[N];return b[f].apply(b,arguments)}})}function F(b,c,d,g){return c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b),c.requireType=b,c.requireModules=g,d&&(c.originalError=d),c}function ha(){return G&&G.readyState==="interactive"?G:(M(document.getElementsByTagName("script"),function(b){if(b.readyState==="interactive")return G=b}),G)}var j,p,u,A,s,B,G,H,ba,ca,ia=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,ja=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,da=/\.js$/,ka=/^\.\//;p=Object.prototype;var I=p.toString,E=p.hasOwnProperty;p=Array.prototype;var ga=p.slice,la=p.splice,v=typeof window!="undefined"&&!!navigator&&!!document,ea=!v&&typeof importScripts!="undefined",ma=v&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,N="_",R=typeof opera!="undefined"&&opera.toString()==="[object Opera]",y={},r={},O=[],K=!1;if(typeof define=="undefined"){if(typeof requirejs!="undefined"){if(w(requirejs))return;r=requirejs,requirejs=void 0}typeof require!="undefined"&&!w(require)&&(r=require,require=void 0),j=requirejs=function(b,c,d,g){var f,o=N;return!D(b)&&typeof b!="string"&&(f=b,D(c)?(b=c,c=d,d=g):b=[]),f&&f.context&&(o=f.context),(g=y[o])||(g=y[o]=j.s.newContext(o)),f&&g.configure(f),g.require(b,c,d)},j.config=function(b){return j(b)},require||(require=j),j.version="2.0.5",j.jsExtRegExp=/^\/|:|\?|\.js$/,j.isBrowser=v,p=j.s={contexts:y,newContext:function(b){function c(a,e,k){var m,b,n,c,f,d,h,g=e&&e.split("/");m=g;var j=l.map,i=j&&j["*"];if(a&&a.charAt(0)===".")if(e){m=l.pkgs[e]?g=[e]:g.slice(0,g.length-1),e=a=m.concat(a.split("/"));for(m=0;e[m];m+=1)if(b=e[m],b===".")e.splice(m,1),m-=1;else if(b===".."){if(m===1&&(e[2]===".."||e[0]===".."))break;m>0&&(e.splice(m-1,2),m-=2)}m=l.pkgs[e=a[0]],a=a.join("/"),m&&a===e+"/"+m.main&&(a=e)}else a.indexOf("./")===0&&(a=a.substring(2));if(k&&(g||i)&&j){e=a.split("/");for(m=e.length;m>0;m-=1){n=e.slice(0,m).join("/");if(g)for(b=g.length;b>0;b-=1)if(k=j[g.slice(0,b).join("/")])if(k=k[n]){c=k,f=m;break}if(c)break;!d&&i&&i[n]&&(d=i[n],h=m)}!c&&d&&(c=d,f=h),c&&(e.splice(0,f,c),a=e.join("/"))}return a}function d(a){v&&o(document.getElementsByTagName("script"),function(e){if(e.getAttribute("data-requiremodule")===a&&e.getAttribute("data-requirecontext")===h.contextName)return e.parentNode.removeChild(e),!0})}function g(a){var e=l.paths[a];if(e&&D(e)&&e.length>1)return d(a),e.shift(),h.undef(a),h.require([a]),!0}function f(a,e,k,m){var b,n,f=a?a.indexOf("!"):-1,d=null,g=e?e.name:null,j=a,l=!0,i="";return a||(l=!1,a="_@r"+(M+=1)),f!==-1&&(d=a.substring(0,f),a=a.substring(f+1,a.length)),d&&(d=c(d,g,m),n=q[d]),a&&(d?i=n&&n.normalize?n.normalize(a,function(a){return c(a,g,m)}):c(a,g,m):(i=c(a,g,m),b=h.nameToUrl(i))),a=d&&!n&&!k?"_unnormalized"+(N+=1):"",{prefix:d,name:i,parentMap:e,unnormalized:!!a,url:b,originalName:j,isDefine:l,id:(d?d+"!"+i:i)+a}}function p(a){var e=a.id,k=i[e];return k||(k=i[e]=new h.Module(a)),k}function r(a,e,k){var b=a.id,c=i[b];E.call(q,b)&&(!c||c.defineEmitComplete)?e==="defined"&&k(q[b]):p(a).on(e,k)}function z(a,e){var k=a.requireModules,b=!1;e?e(a):(o(k,function(e){if(e=i[e])e.error=a,e.events.error&&(b=!0,e.emit("error",a))}),!b)&&j.onError(a)}function s(){O.length&&(la.apply(C,[C.length-1,0].concat(O)),O=[])}function u(a,e,k){return a=a&&a.map,e=$(k||h.require,a,e),aa(e,h,a),e.isBrowser=v,e}function y(a){delete i[a],o(L,function(e,k){if(e.map.id===a)return L.splice(k,1),e.defined||(h.waitCount-=1),!0})}function A(a,e){var k=a.map.id,b=a.depMaps,c;if(a.inited)return e[k]?a:(e[k]=!0,o(b,function(a){if(a=i[a.id])return!a.inited||!a.enabled?(c=null,delete e[k],!0):c=A(a,J({},e))}),c)}function B(a,e,k){var b=a.map.id,c=a.depMaps;if(a.inited&&a.map.isDefine)return e[b]?q[b]:(e[b]=a,o(c,function(c){var c=c.id,d=i[c];!P[c]&&d&&(!d.inited||!d.enabled?k[b]=!0:(d=B(d,e,k),k[c]||a.defineDepById(c,d)))}),a.check(!0),q[b])}function H(a){a.check()}function S(){var a,e,b,c,f=(b=l.waitSeconds*1e3)&&h.startTime+b<(new Date).getTime(),n=[],j=!1,fa=!0;if(!T){T=!0,x(i,function(b){a=b.map,e=a.id;if(b.enabled&&!b.error)if(!b.inited&&f)g(e)?j=c=!0:(n.push(e),d(e));else if(!b.inited&&b.fetched&&a.isDefine&&(j=!0,!a.prefix))return fa=!1});if(f&&n.length)return b=F("timeout","Load timeout for modules: "+n,null,n),b.contextName=h.contextName,z(b);fa&&(o(L,function(a){if(!a.defined){var a=A(a,{}),e={};a&&(B(a,e,{}),x(e,H))}}),x(i,H)),(!f||c)&&j&&(v||ea)&&!U&&(U=setTimeout(function(){U=0,S()},50)),T=!1}}function V(a){p(f(a[0],null,!0)).init(a[1],a[2])}function I(a){var a=a.currentTarget||a.srcElement,e=h.onScriptLoad;return a.detachEvent&&!R?a.detachEvent("onreadystatechange",e):a.removeEventListener("load",e,!1),e=h.onScriptError,a.detachEvent&&!R||a.removeEventListener("error",e,!1),{node:a,id:a&&a.getAttribute("data-requiremodule")}}var T,W,h,P,U,l={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},i={},X={},C=[],q={},Q={},M=1,N=1,L=[];return P={require:function(a){return u(a)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports=q[a.map.id]={}},module:function(a){return a.module={id:a.map.id,uri:a.map.url,config:function(){return l.config&&l.config[a.map.id]||{}},exports:q[a.map.id]}}},W=function(a){this.events=X[a.id]||{},this.map=a,this.shim=l.shim[a.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},W.prototype={init:function(a,e,b,c){c=c||{},this.inited||(this.factory=e,b?this.on("error",b):this.events.error&&(b=t(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.depMaps.rjsSkipMap=a.rjsSkipMap,this.errback=b,this.inited=!0,this.ignore=c.ignore,c.enabled||this.enabled?this.enable():this.check())},defineDepById:function(a,e){var b;return o(this.depMaps,function(e,c){if(e.id===a)return b=c,!0}),this.defineDep(b,e)},defineDep:function(a,e){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,h.startTime=(new Date).getTime();var a=this.map;if(!this.shim)return a.prefix?this.callPlugin():this.load();u(this,!0)(this.shim.deps||[],t(this,function(){return a.prefix?this.callPlugin():this.load()}))}},load:function(){var a=this.map.url;Q[a]||(Q[a]=!0,h.load(this.map.id,a))},check:function(a){if(this.enabled&&!this.enabling){var e,b,c=this.map.id;b=this.depExports;var d=this.exports,n=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(w(n)){if(this.events.error)try{d=h.execCb(c,n,b,d)}catch(f){e=f}else d=h.execCb(c,n,b,d);this.map.isDefine&&((b=this.module)&&b.exports!==void 0&&b.exports!==this.exports?d=b.exports:d===void 0&&this.usingExports&&(d=this.exports));if(e)return e.requireMap=this.map,e.requireModules=[this.map.id],e.requireType="define",z(this.error=e)}else d=n;this.exports=d,this.map.isDefine&&!this.ignore&&(q[c]=d,j.onResourceLoad)&&j.onResourceLoad(h,this.map,this.depMaps),delete i[c],this.defined=!0,h.waitCount-=1,h.waitCount===0&&(L=[])}this.defining=!1,!a&&this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,e=a.id,b=f(a.prefix,null,!1,!0);r(b,"defined",t(this,function(b){var d;d=this.map.name;var k=this.map.parentMap?this.map.parentMap.name:null;if(this.map.unnormalized){if(b.normalize&&(d=b.normalize(d,function(a){return c(a,k,!0)})||""),b=f(a.prefix+"!"+d,this.map.parentMap,!1,!0),r(b,"defined",t(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),b=i[b.id])this.events.error&&b.on("error",t(this,function(a){this.emit("error",a)})),b.enable()}else d=t(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),d.error=t(this,function(a){this.inited=!0,this.error=a,a.requireModules=[e],x(i,function(a){a.map.id.indexOf(e+"_unnormalized")===0&&y(a.map.id)}),z(a)}),d.fromText=function(a,b){var e=K;e&&(K=!1),p(f(a)),j.exec(b),e&&(K=!0),h.completeLoad(a)},b.load(a.name,u(a.parentMap,!0,function(a,b,e){return a.rjsSkipMap=!0,h.require(a,b,e)}),d,l)})),h.enable(b,this),this.pluginMaps[b.id]=b},enable:function(){this.enabled=!0,this.waitPushed||(L.push(this),h.waitCount+=1,this.waitPushed=!0),this.enabling=!0,o(this.depMaps,t(this,function(a,b){var c,d;if(typeof a=="string"){a=f(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[b]=a;if(c=P[a.id]){this.depExports[b]=c(this);return}this.depCount+=1,r(a,"defined",t(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&r(a,"error",this.errback)}c=a.id,d=i[c],!P[c]&&d&&!d.enabled&&h.enable(a,this)})),x(this.pluginMaps,t(this,function(a){var b=i[a.id];b&&!b.enabled&&h.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){o(this.events[a],function(a){a(b)}),a==="error"&&delete this.events[a]}},h={config:l,contextName:b,registry:i,defined:q,urlFetched:Q,waitCount:0,defQueue:C,Module:W,makeModuleMap:f,configure:function(a){a.baseUrl&&a.baseUrl.charAt(a.baseUrl.length-1)!=="/"&&(a.baseUrl+="/");var b=l.pkgs,c=l.shim,d=l.paths,g=l.map;J(l,a,!0),l.paths=J(d,a.paths,!0),a.map&&(l.map=J(g||{},a.map,!0,!0)),a.shim&&(x(a.shim,function(a,b){D(a)&&(a={deps:a}),a.exports&&!a.exports.__buildReady&&(a.exports=h.makeShimExports(a.exports)),c[b]=a}),l.shim=c),a.packages&&(o(a.packages,function(a){a=typeof a=="string"?{name:a}:a,b[a.name]={name:a.name,location:a.location||a.name,main:(a.main||"main").replace(ka,"").replace(da,"")}}),l.pkgs=b),x(i,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=f(b))}),(a.deps||a.callback)&&h.require(a.deps||[],a.callback)},makeShimExports:function(a){var b;return typeof a=="string"?(b=function(){return Z(a)},b.exports=a,b):function(){return a.apply(Y,arguments)}},requireDefined:function(a,b){var c=f(a,b,!1,!0).id;return E.call(q,c)},requireSpecified:function(a,b){return a=f(a,b,!1,!0).id,E.call(q,a)||E.call(i,a)},require:function(a,e,c,d){var g;if(typeof a=="string")return w(e)?z(F("requireargs","Invalid require call"),c):j.get?j.get(h,a,e):(a=f(a,e,!1,!0),a=a.id,E.call(q,a)?q[a]:z(F("notloaded",'Module name "'+a+'" has not been loaded yet for context: '+b)));c&&!w(c)&&(d=c,c=void 0),e&&!w(e)&&(d=e,e=void 0);for(s();C.length;){if(g=C.shift(),g[0]===null)return z(F("mismatch","Mismatched anonymous define() module: "+g[g.length-1]));V(g)}return p(f(null,d)).init(a,e,c,{enabled:!0}),S(),h.require},undef:function(a){s();var b=f(a,null,!0),c=i[a];delete q[a],delete Q[b.url],delete X[a],c&&(c.events.defined&&(X[a]=c.events),y(a))},enable:function(a){i[a.id]&&p(a).enable()},completeLoad:function(a){var b,c,d=l.shim[a]||{},f=d.exports&&d.exports.exports;for(s();C.length;){c=C.shift();if(c[0]===null){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);V(c)}c=i[a];if(!b&&!q[a]&&c&&!c.inited){if(l.enforceDefine&&(!f||!Z(f))){if(g(a))return;return z(F("nodefine","No define call for "+a,null,[a]))}V([a,d.deps||[],d.exports])}S()},toUrl:function(a,b){var d=a.lastIndexOf("."),f=null;return d!==-1&&(f=a.substring(d,a.length),a=a.substring(0,d)),h.nameToUrl(c(a,b&&b.id,!0),f)},nameToUrl:function(a,b){var c,d,f,g,h,i;if(j.jsExtRegExp.test(a))g=a+(b||"");else{c=l.paths,d=l.pkgs,g=a.split("/");for(h=g.length;h>0;h-=1){if(i=g.slice(0,h).join("/"),f=d[i],i=c[i]){D(i)&&(i=i[0]),g.splice(0,h,i);break}if(f){c=a===f.name?f.location+"/"+f.main:f.location,g.splice(0,h,c);break}}g=g.join("/"),g+=b||(/\?/.test(g)?"":".js"),g=(g.charAt(0)==="/"||g.match(/^[\w\+\.\-]+:/)?"":l.baseUrl)+g}return l.urlArgs?g+((g.indexOf("?")===-1?"?":"&")+l.urlArgs):g},load:function(a,b){j.load(h,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if(a.type==="load"||ma.test((a.currentTarget||a.srcElement).readyState))G=null,a=I(a),h.completeLoad(a.id)},onScriptError:function(a){var b=I(a);if(!g(b.id))return z(F("scripterror","Script error",a,[b.id]))}}}},j({}),aa(j),v&&(u=p.head=document.getElementsByTagName("head")[0],A=document.getElementsByTagName("base")[0])&&(u=p.head=A.parentNode),j.onError=function(b){throw b},j.load=function(b,c,d){var g=b&&b.config||{},f;if(v)return f=g.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),f.type=g.scriptType||"text/javascript",f.charset="utf-8",f.async=!0,f.setAttribute("data-requirecontext",b.contextName),f.setAttribute("data-requiremodule",c),f.attachEvent&&!(f.attachEvent.toString&&f.attachEvent.toString().indexOf("[native code")<0)&&!R?(K=!0,f.attachEvent("onreadystatechange",b.onScriptLoad)):(f.addEventListener("load",b.onScriptLoad,!1),f.addEventListener("error",b.onScriptError,!1)),f.src=d,H=f,A?u.insertBefore(f,A):u.appendChild(f),H=null,f;ea&&(importScripts(d),b.completeLoad(c))},v&&M(document.getElementsByTagName("script"),function(b){u||(u=b.parentNode);if(s=b.getAttribute("data-main"))return r.baseUrl||(B=s.split("/"),ba=B.pop(),ca=B.length?B.join("/")+"/":"./",r.baseUrl=ca,s=ba),s=s.replace(da,""),r.deps=r.deps?r.deps.concat(s):[s],!0}),define=function(b,c,d){var g,f;typeof b!="string"&&(d=c,c=b,b=null),D(c)||(d=c,c=[]),!c.length&&w(d)&&d.length&&(d.toString().replace(ia,"").replace(ja,function(b,d){c.push(d)}),c=(d.length===1?["require"]:["require","exports","module"]).concat(c)),K&&(g=H||ha())&&(b||(b=g.getAttribute("data-requiremodule")),f=y[g.getAttribute("data-requirecontext")]),(f?f.defQueue:O).push([b,c,d])},define.amd={jQuery:!0},j.exec=function(b){return eval(b)},j(r)}})(this),function(){var VERSION="0.5.1",guid=1,util={bind:function(fn,ctx){return util.isObject(fn)?(util.each(fn,function(fun,name){util.typeOf(fun)==="function"&&(fn[name]=util.bind(fun,fn))}),fn):Function.prototype.bind?fn.bind(ctx):function(){return fn.apply(ctx,arguments)}},clone:function(obj){if(util.isArray(obj))return obj.slice();if(util.isObject(obj)){var newObj={};return util.each(obj,function(value,key){newObj[key]=value}),newObj}return obj},create:function(context){var instance;if(typeof Object.create=="function")instance=Object.create(context);else{var F=function(){};F.prototype=context,instance=new F}return instance},each:function(list,fn,context){if(util.isArray(list))if(Array.prototype.forEach)list.forEach(fn,context);else for(var i=0,l=list.length;i<l;i++)fn.call(context,list[i],i);else for(var key in list)fn.call(context,list[key],key)},filter:function(list,fn,context){var results=[];return util.isArray(list)&&Array.prototype.filter?list.filter(fn,context):(util.each(list,function(value){fn.call(context,value)&&results.push(value)}),results)},isArray:function(val){return util.typeOf(val)==="array"},isObject:function(val){return util.typeOf(val)==="object"},keys:function(list){return util.map(list,function(value,key){return key})},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})},map:function(list,fn,context){var results=[];return util.isArray(list)&&Array.prototype.map?list.map(fn,context):(util.each(list,function(value,index){results.push(fn.call(context,value,index))}),results)},size:function(list){return util.isArray(list)?list.length:util.keys(list).length},toArray:function(val){return util.isObject(val)?util.values(val):Array.prototype.slice.call(val,0)},typeOf:function(val){return Object.prototype.toString.call(val).replace(/\[object |\]/g,"").toLowerCase()},values:function(list){return util.map(list,function(value,key){return value})}},_={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(event){_.eventHandlers[event.guid][event.type]||(_.eventHandlers[event.guid][event.type]=[]),_.eventHandlers[event.guid][event.type].push({guid:event.guid,handler:event.handler,scope:event.scope,type:event.type})},addEventHandler:function(argTypeOrMap,argHandlerOrScope,argScope){var eventMap={},scope;typeof argTypeOrMap=="string"?(scope=argScope||!1,eventMap[argTypeOrMap]=argHandlerOrScope):(scope=argHandlerOrScope||!1,eventMap=argTypeOrMap),util.each(eventMap,function(handler,eventString){var events=eventString.split(" ");util.each(events,function(eventType){_.addEvent.call(this,{guid:this._guid,handler:handler,scope:scope,type:eventType})},this)},this)},addGuid:function(object,forceGuid){if(object._guid&&!forceGuid)return;object._guid=guid++,_.attributes[object._guid]={},_.eventHandlers[object._guid]={}},attr:function(guid){return _.attributes[guid]},createModule:function(context){var instance=util.create(context);return _.addGuid(instance,!0),Stapes.mixinEvents(instance),instance},emitEvents:function(type,data,explicitType,explicitGuid){explicitType=explicitType||!1,explicitGuid=explicitGuid||this._guid,util.each(_.eventHandlers[explicitGuid][type],function(event){var scope=event.scope?event.scope:this;explicitType&&(event.type=explicitType),event.scope=scope,event.handler.call(event.scope,data,event)},this)},removeEventHandler:function(type,handler){var handlers=_.eventHandlers[this._guid];type&&handler?util.each(handlers[type],function(eventObject,index){eventObject.handler===handler&&handlers[type].splice(index--,1)},this):type?delete handlers[type]:_.eventHandlers[this._guid]={}},setAttribute:function(key,value){var itemExists=this.has(key),oldValue=_.attr(this._guid)[key];if(value===oldValue)return;_.attr(this._guid)[key]=value,this.emit("change",key),this.emit("change:"+key,value);var mutateData={key:key,newValue:value,oldValue:oldValue||null};this.emit("mutate",mutateData),this.emit("mutate:"+key,mutateData);var specificEvent=itemExists?"update":"create";this.emit(specificEvent,key),this.emit(specificEvent+":"+key,value)},removeAttribute:function(key){var itemExists=this.has(key),oldValue=_.attr(this._guid)[key];if(!itemExists)return;delete _.attr(this._guid)[key],this.emit("change",key),this.emit("change:"+key);var mutateData={key:key,newValue:null,oldValue:oldValue||null};this.emit("mutate",mutateData),this.emit("mutate:"+key,mutateData),this.emit("remove",key),this.emit("remove:"+key)},updateAttribute:function(key,fn){var item=this.get(key),newValue=fn(util.clone(item));_.setAttribute.call(this,key,newValue)}},Events={emit:function(types,data){data=typeof data=="undefined"?null:data,util.each(types.split(" "),function(type){_.eventHandlers[-1].all&&_.emitEvents.call(this,"all",data,type,-1),_.eventHandlers[-1][type]&&_.emitEvents.call(this,type,data,type,-1),typeof this._guid=="number"&&(_.eventHandlers[this._guid].all&&_.emitEvents.call(this,"all",data,type),_.eventHandlers[this._guid][type]&&_.emitEvents.call(this,type,data))},this)},off:function(){_.removeEventHandler.apply(this,arguments)},on:function(){_.addEventHandler.apply(this,arguments)}};_.Module={create:function(){return _.createModule(this)},each:function(fn,ctx){util.each(_.attr(this._guid),fn,ctx||this)},extend:function(objectOrValues,valuesIfObject){var object=valuesIfObject?objectOrValues:this,values=valuesIfObject?valuesIfObject:objectOrValues;return util.each(values,function(value,key){object[key]=value}),this},filter:function(fn){return util.filter(_.attr(this._guid),fn)},get:function(input){if(typeof input=="string")return this.has(input)?_.attr(this._guid)[input]:null;if(typeof input=="function"){var items=this.filter(input);return items.length?items[0]:null}},getAll:function(){return util.clone(_.attr(this._guid))},getAllAsArray:function(){var arr=util.map(_.attr(this._guid),function(value,key){return util.isObject(value)&&(value.id=key),value});return util.clone(arr)},has:function(key){return typeof _.attr(this._guid)[key]!="undefined"},push:function(input){util.isArray(input)?util.each(input,function(value){_.setAttribute.call(this,util.makeUuid(),value)},this):_.setAttribute.call(this,util.makeUuid(),input)},remove:function(input){typeof input=="function"?this.each(function(item,key){input(item)&&_.removeAttribute.call(this,key)}):_.removeAttribute.call(this,input)},set:function(objOrKey,value){util.isObject(objOrKey)?util.each(objOrKey,function(value,key){_.setAttribute.call(this,key,value)},this):_.setAttribute.call(this,objOrKey,value)},size:function(){return util.size(_.attributes[this._guid])},update:function(keyOrFn,fn){typeof keyOrFn=="string"?_.updateAttribute.call(this,keyOrFn,fn):typeof keyOrFn=="function"&&this.each(function(value,key){_.updateAttribute.call(this,key,keyOrFn)})}};var Stapes={_:_,create:function(){return _.createModule(_.Module)},extend:function(obj){util.each(obj,function(value,key){_.Module[key]=value})},mixinEvents:function(obj){return obj=obj||{},_.addGuid(obj),util.each(Events,function(value,key){obj[key]=value}),obj},on:function(){_.addEventHandler.apply(this,arguments)},util:util,version:VERSION};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=Stapes),exports.Stapes=Stapes):typeof define=="function"&&define.amd?define("libs/stapes",[],function(){return Stapes}):window.Stapes=Stapes}(),define("plugins/async",[],function(){function injectScript(src){var s,t;s=document.createElement("script"),s.type="text/javascript",s.async=!0,s.src=src,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(s,t)}function formatUrl(name,id){var paramRegex=/!(.+)/,url=name.replace(paramRegex,""),param=paramRegex.test(name)?name.replace(/.+!/,""):DEFAULT_PARAM_NAME;return url+=url.indexOf("?")<0?"?":"&",url+param+"="+id}function uid(){return _uid+=1,"__async_req_"+_uid+"__"}var DEFAULT_PARAM_NAME="callback",_uid=0;return{load:function(name,req,onLoad,config){if(config.isBuild)onLoad(null);else{var id=uid();window[id]=onLoad,injectScript(formatUrl(name,id))}}}}),define("modules/adapters/google-maps",["plugins/async!http://maps.googleapis.com/maps/api/js?key=AIzaSyDtVrxyniaAXbNuA2d_pjFdBmzOQJD1bHY&sensor=false&libraries=drawing"],function(){return google.maps}),define("util/gm-label-marker",["google/maps"],function(gm){function MarkerLabel_(marker,crossURL,handCursorURL){this.marker_=marker,this.handCursorURL_=marker.handCursorURL,this.labelDiv_=document.createElement("div"),this.labelDiv_.style.cssText="position: absolute; overflow: hidden;",this.eventDiv_=document.createElement("div"),this.eventDiv_.style.cssText=this.labelDiv_.style.cssText,this.eventDiv_.setAttribute("onselectstart","return false;"),this.eventDiv_.setAttribute("ondragstart","return false;"),this.crossDiv_=MarkerLabel_.getSharedCross(crossURL)}function MarkerWithLabel(opt_options){opt_options=opt_options||{},opt_options.labelContent=opt_options.labelContent||"",opt_options.labelAnchor=opt_options.labelAnchor||new google.maps.Point(0,0),opt_options.labelClass=opt_options.labelClass||"markerLabels",opt_options.labelStyle=opt_options.labelStyle||{},opt_options.labelInBackground=opt_options.labelInBackground||!1,typeof opt_options.labelVisible=="undefined"&&(opt_options.labelVisible=!0),typeof opt_options.raiseOnDrag=="undefined"&&(opt_options.raiseOnDrag=!0),typeof opt_options.clickable=="undefined"&&(opt_options.clickable=!0),typeof opt_options.draggable=="undefined"&&(opt_options.draggable=!1),typeof opt_options.optimized=="undefined"&&(opt_options.optimized=!1),opt_options.crossImage=opt_options.crossImage||"http://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png",opt_options.handCursor=opt_options.handCursor||"http://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur",opt_options.optimized=!1,this.label=new MarkerLabel_(this,opt_options.crossImage,opt_options.handCursor),google.maps.Marker.apply(this,arguments)}return MarkerLabel_.prototype=new google.maps.OverlayView,MarkerLabel_.getSharedCross=function(crossURL){var div;return typeof MarkerLabel_.getSharedCross.crossDiv=="undefined"&&(div=document.createElement("img"),div.style.cssText="position: absolute; z-index: 1000002; display: none;",div.style.marginLeft="-8px",div.style.marginTop="-9px",div.src=crossURL,MarkerLabel_.getSharedCross.crossDiv=div),MarkerLabel_.getSharedCross.crossDiv},MarkerLabel_.prototype.onAdd=function(){var me=this,cMouseIsDown=!1,cDraggingLabel=!1,cSavedZIndex,cLatOffset,cLngOffset,cIgnoreClick,cRaiseEnabled,cStartPosition,cStartCenter,cRaiseOffset=20,cDraggingCursor="url("+this.handCursorURL_+")",cAbortEvent=function(e){e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},cStopBounce=function(){me.marker_.setAnimation(null)};this.getPanes().overlayImage.appendChild(this.labelDiv_),typeof MarkerLabel_.getSharedCross.processed=="undefined"&&(this.getPanes().overlayImage.appendChild(this.crossDiv_),MarkerLabel_.getSharedCross.processed=!0),this.listeners_=[google.maps.event.addDomListener(this.eventDiv_,"mouseover",function(e){if(me.marker_.getDraggable()||me.marker_.getClickable())this.style.cursor="pointer",google.maps.event.trigger(me.marker_,"mouseover",e)}),google.maps.event.addDomListener(this.eventDiv_,"mouseout",function(e){(me.marker_.getDraggable()||me.marker_.getClickable())&&!cDraggingLabel&&(this.style.cursor=me.marker_.getCursor(),google.maps.event.trigger(me.marker_,"mouseout",e))}),google.maps.event.addDomListener(this.eventDiv_,"mousedown",function(e){cDraggingLabel=!1,me.marker_.getDraggable()&&(cMouseIsDown=!0,this.style.cursor=cDraggingCursor);if(me.marker_.getDraggable()||me.marker_.getClickable())google.maps.event.trigger(me.marker_,"mousedown",e),cAbortEvent(e)}),google.maps.event.addDomListener(document,"mouseup",function(mEvent){var position;cMouseIsDown&&(cMouseIsDown=!1,me.eventDiv_.style.cursor="pointer",google.maps.event.trigger(me.marker_,"mouseup",mEvent));if(cDraggingLabel){if(cRaiseEnabled){position=me.getProjection().fromLatLngToDivPixel(me.marker_.getPosition()),position.y+=cRaiseOffset,me.marker_.setPosition(me.getProjection().fromDivPixelToLatLng(position));try{me.marker_.setAnimation(google.maps.Animation.BOUNCE),setTimeout(cStopBounce,1406)}catch(e){}}me.crossDiv_.style.display="none",me.marker_.setZIndex(cSavedZIndex),cIgnoreClick=!0,cDraggingLabel=!1,mEvent.latLng=me.marker_.getPosition(),google.maps.event.trigger(me.marker_,"dragend",mEvent)}}),google.maps.event.addListener(me.marker_.getMap(),"mousemove",function(mEvent){var position;cMouseIsDown&&(cDraggingLabel?(mEvent.latLng=new google.maps.LatLng(mEvent.latLng.lat()-cLatOffset,mEvent.latLng.lng()-cLngOffset),position=me.getProjection().fromLatLngToDivPixel(mEvent.latLng),cRaiseEnabled&&(me.crossDiv_.style.left=position.x+"px",me.crossDiv_.style.top=position.y+"px",me.crossDiv_.style.display="",position.y-=cRaiseOffset),me.marker_.setPosition(me.getProjection().fromDivPixelToLatLng(position)),cRaiseEnabled&&(me.eventDiv_.style.top=position.y+cRaiseOffset+"px"),google.maps.event.trigger(me.marker_,"drag",mEvent)):(cLatOffset=mEvent.latLng.lat()-me.marker_.getPosition().lat(),cLngOffset=mEvent.latLng.lng()-me.marker_.getPosition().lng(),cSavedZIndex=me.marker_.getZIndex(),cStartPosition=me.marker_.getPosition(),cStartCenter=me.marker_.getMap().getCenter(),cRaiseEnabled=me.marker_.get("raiseOnDrag"),cDraggingLabel=!0,me.marker_.setZIndex(1e6),mEvent.latLng=me.marker_.getPosition(),google.maps.event.trigger(me.marker_,"dragstart",mEvent)))}),google.maps.event.addDomListener(document,"keydown",function(e){cDraggingLabel&&e.keyCode===27&&(cRaiseEnabled=!1,me.marker_.setPosition(cStartPosition),me.marker_.getMap().setCenter(cStartCenter),google.maps.event.trigger(document,"mouseup",e))}),google.maps.event.addDomListener(this.eventDiv_,"click",function(e){if(me.marker_.getDraggable()||me.marker_.getClickable())cIgnoreClick?cIgnoreClick=!1:(google.maps.event.trigger(me.marker_,"click",e),cAbortEvent(e))}),google.maps.event.addDomListener(this.eventDiv_,"dblclick",function(e){if(me.marker_.getDraggable()||me.marker_.getClickable())google.maps.event.trigger(me.marker_,"dblclick",e),cAbortEvent(e)}),google.maps.event.addListener(this.marker_,"dragstart",function(mEvent){cDraggingLabel||(cRaiseEnabled=this.get("raiseOnDrag"))}),google.maps.event.addListener(this.marker_,"drag",function(mEvent){cDraggingLabel||cRaiseEnabled&&(me.setPosition(cRaiseOffset),me.labelDiv_.style.zIndex=1e6+(this.get("labelInBackground")?-1:1))}),google.maps.event.addListener(this.marker_,"dragend",function(mEvent){cDraggingLabel||cRaiseEnabled&&me.setPosition(0)}),google.maps.event.addListener(this.marker_,"position_changed",function(){me.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){me.setZIndex()}),google.maps.event.addListener(this.marker_,"visible_changed",function(){me.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){me.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){me.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){me.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){me.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){me.setStyles()}),google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){me.setStyles()})]},MarkerLabel_.prototype.onRemove=function(){var i;this.labelDiv_.parentNode.removeChild(this.labelDiv_),this.eventDiv_.parentNode.removeChild(this.eventDiv_);for(i=0;i<this.listeners_.length;i++)google.maps.event.removeListener(this.listeners_[i])},MarkerLabel_.prototype.draw=function(){this.setContent(),this.setTitle(),this.setStyles()},MarkerLabel_.prototype.setContent=function(){var content=this.marker_.get("labelContent");typeof content.nodeType=="undefined"?(this.labelDiv_.innerHTML=content,this.eventDiv_.innerHTML=this.labelDiv_.innerHTML):(this.labelDiv_.innerHTML="",this.labelDiv_.appendChild(content),content=content.cloneNode(!0),this.eventDiv_.appendChild(content))},MarkerLabel_.prototype.setTitle=function(){this.eventDiv_.title=this.marker_.getTitle()||""},MarkerLabel_.prototype.setStyles=function(){var i,labelStyle;this.labelDiv_.className=this.marker_.get("labelClass"),this.eventDiv_.className=this.labelDiv_.className,this.labelDiv_.style.cssText="",this.eventDiv_.style.cssText="",labelStyle=this.marker_.get("labelStyle");for(i in labelStyle)labelStyle.hasOwnProperty(i)&&(this.labelDiv_.style[i]=labelStyle[i],this.eventDiv_.style[i]=labelStyle[i]);this.setMandatoryStyles()},MarkerLabel_.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute",this.labelDiv_.style.overflow="hidden",typeof this.labelDiv_.style.opacity!="undefined"&&this.labelDiv_.style.opacity!==""&&(this.labelDiv_.style.filter="alpha(opacity="+this.labelDiv_.style.opacity*100+")"),this.eventDiv_.style.position=this.labelDiv_.style.position,this.eventDiv_.style.overflow=this.labelDiv_.style.overflow,this.eventDiv_.style.opacity=.01,this.eventDiv_.style.filter="alpha(opacity=1)",this.setAnchor(),this.setPosition(),this.setVisible()},MarkerLabel_.prototype.setAnchor=function(){var anchor=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-anchor.x+"px",this.labelDiv_.style.marginTop=-anchor.y+"px",this.eventDiv_.style.marginLeft=-anchor.x+"px",this.eventDiv_.style.marginTop=-anchor.y+"px"},MarkerLabel_.prototype.setPosition=function(yOffset){var position=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());typeof yOffset=="undefined"&&(yOffset=0),this.labelDiv_.style.left=Math.round(position.x)+"px",this.labelDiv_.style.top=Math.round(position.y-yOffset)+"px",this.eventDiv_.style.left=this.labelDiv_.style.left,this.eventDiv_.style.top=this.labelDiv_.style.top,this.setZIndex()},MarkerLabel_.prototype.setZIndex=function(){var zAdjust=this.marker_.get("labelInBackground")?-1:1;typeof this.marker_.getZIndex()=="undefined"?(this.labelDiv_.style.zIndex=parseInt(this.labelDiv_.style.top,10)+zAdjust,this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex):(this.labelDiv_.style.zIndex=this.marker_.getZIndex()+zAdjust,this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex)},MarkerLabel_.prototype.setVisible=function(){this.marker_.get("labelVisible")?this.labelDiv_.style.display=this.marker_.getVisible()?"block":"none":this.labelDiv_.style.display="none",this.eventDiv_.style.display=this.labelDiv_.style.display},MarkerWithLabel.prototype=new google.maps.Marker,MarkerWithLabel.prototype.setMap=function(theMap){google.maps.Marker.prototype.setMap.apply(this,arguments),this.label.setMap(theMap)},MarkerWithLabel}),define("util/domready",[],function(){function runCallbacks(callbacks){var i;for(i=0;i<callbacks.length;i+=1)callbacks[i](doc)}function callReady(){var callbacks=readyCalls;isPageLoaded&&callbacks.length&&(readyCalls=[],runCallbacks(callbacks))}function pageLoaded(){isPageLoaded||(isPageLoaded=!0,scrollIntervalId&&clearInterval(scrollIntervalId),callReady())}function domReady(callback){return isPageLoaded?callback(doc):readyCalls.push(callback),domReady}var isTop,testDiv,scrollIntervalId,isBrowser=typeof window!="undefined"&&window.document,isPageLoaded=!isBrowser,doc=isBrowser?document:null,readyCalls=[];if(isBrowser){if(document.addEventListener)document.addEventListener("DOMContentLoaded",pageLoaded,!1),window.addEventListener("load",pageLoaded,!1);else if(window.attachEvent){window.attachEvent("onload",pageLoaded),testDiv=document.createElement("div");try{isTop=window.frameElement===null}catch(e){}testDiv.doScroll&&isTop&&window.external&&(scrollIntervalId=setInterval(function(){try{testDiv.doScroll(),pageLoaded()}catch(e){}},30))}document.readyState==="complete"&&pageLoaded()}return domReady.version="2.0.1",domReady.load=function(name,req,onLoad,config){config.isBuild?onLoad(null):domReady(onLoad)},domReady}),define("mediators/sun-map",["stapes","google/maps","util/gm-label-marker","util/domready"],function(Stapes,gm,MarkerWithLabel,domready){function attr(ele,attr){var result=ele.getAttribute&&ele.getAttribute(attr)||null;if(!result){var attrs=ele.attributes,length=attrs.length;for(var i=0;i<length;i++)attrs[i].nodeName===attr&&(result=attrs[i].nodeValue)}return result}var icons={},SunMap=Stapes.create().extend({init:function(){var self=this,mapId="map-wrap",mapOptions={center:new gm.LatLng(0,0),zoom:2,minZoom:1,maxZoom:4,mapTypeControl:!1,streetViewControl:!1};self.initEventHandlers(),domready(function(){var el=document.getElementById(mapId);self.set("tileUrl",attr(el,"data-tile-path")),self.set("mapOptions",mapOptions),self.set("map",new gm.Map(el,mapOptions))})},pointToLatLng:function(point){var proj=this.get("projection"),factor=1<<this.get("mapOptions").minZoom-2,ll=proj.fromPointToLatLng(new gm.Point(point.x/factor,point.y/factor));return ll},latLngToPoint:function(latLng){var proj=this.get("projection"),factor=1<<this.get("mapOptions").minZoom-2,wc=proj.fromLatLngToPoint(latLng);return new gm.Point(wc.x*factor,wc.y*factor)},initEventHandlers:function(){function setProj(map){var proj=map.getProjection();proj?self.set("projection",proj):gm.event.addListenerOnce(map,"projection_changed",function(){setProj(map)})}var self=this;this.on({"create:map":function(map){self.initMapTypes(),setProj(map)},"create:projection":function(){self.initMarkers()}})},initMapTypes:function(){function getNormalizedCoord(coord,zoom){var y=coord.y,x=coord.x,tileRange=1<<zoom;return y<0||y>=tileRange?null:x<0||x>=tileRange?null:{x:x,y:tileRange-y-1}}var self=this,map=self.get("map"),mapOpts=self.get("mapOptions"),baseUrl=self.get("tileUrl");map.mapTypes.set("sun",new gm.ImageMapType({getTileUrl:function(coord,zoom){var normalizedCoord=getNormalizedCoord(coord,zoom),pfx=zoom>1?"/detailed/":"/plain/";return normalizedCoord?baseUrl+pfx+zoom+"/"+normalizedCoord.x+"/"+normalizedCoord.y+".jpg":baseUrl+"/blank.jpg"},tileSize:new gm.Size(256,256),maxZoom:mapOpts.maxZoom,minZoom:mapOpts.minZoom,name:"sun"})),map.setMapTypeId("sun"),self.emit("types_ready")},initMarkers:function(){function addMarker(opts){var m=new MarkerWithLabel({position:opts.position,title:opts.title,labelContent:opts.labelContent,draggable:!1,raiseOnDrag:!1,labelAnchor:new gm.Point(50,0),labelClass:"sun-label"});m.setMap(map),gm.event.addListener(m,"click",function(event){var infowindow=new gm.InfoWindow({content:"<p>Hello world</p>"});infowindow.open(map,m)}),self.set("marker."+opts.title,m)}var self=this,map=this.get("map"),markers;addMarker({position:new gm.LatLng(0,0),title:"test",labelContent:"Just a Test"})}});return SunMap}),require.config({baseUrl:"js/",map:{"*":{pquery:"libs/pquery/pquery",stapes:"libs/stapes","google/maps":"modules/adapters/google-maps"}}}),require(["mediators/sun-map"],function(sunMap){sunMap.init()}),define("main",function(){})